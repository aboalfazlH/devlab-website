{% extends 'base/base.html' %}

{% block title %}ویرایش پروفایل{% endblock title %}

{% block styles %}
<link rel="stylesheet" href="https://cdn.quilljs.com/1.3.7/quill.snow.css">
<style>
  .quill-wrapper {
    width: 100%;
    margin-bottom: 20px;
  }
  .ql-editor {
    direction: rtl;
    text-align: right;
    min-height: 200px;
  }
  .ql-editor pre,
  .ql-editor code,
  .ql-syntax {
    direction: ltr !important;
    text-align: left !important;
    unicode-bidi: plaintext !important;
  }
</style>
{% endblock styles %}

{% block content %}
<form action="" method="post" enctype="multipart/form-data" class="container mt-4">
    {% csrf_token %}
    
    <div class="mb-3">{{ form.first_name }}</div>
    <div class="mb-3">{{ form.last_name }}</div>
    <div class="mb-3">{{ form.git_account }}</div>
    <div class="mb-3">{{ form.avatar }}</div>
    <div class="mb-3">{{ form.about }}</div>

    <label for="{{ form.bio.id_for_label }}">بیوگرافی</label>
    {{ form.bio }}
    <div class="quill-wrapper">
        <div id="editor"></div>
    </div>

    <div class="mb-3">{{ form.public_email }}</div>
    <div class="mb-3">{{ form.public_phone_number }}</div>
    <div class="mb-3">{{ form.website }}</div>
    <div class="mb-3">{{ form.facebook }}</div>
    <div class="mb-3">{{ form.linkedin }}</div>
    <div class="mb-3">{{ form.telegram }}</div>

    <div class="form-check mb-3">
        <label class="form-check-label" for="{{ form.public_article.id_for_label }}">مقاله عمومی</label>
        {{ form.public_article }}
    </div>

    <button class="btn btn-success" type="submit">تغییر پروفایل</button>
</form>
{% endblock content %}

{% block scripts %}
<script src="https://cdn.quilljs.com/1.3.7/quill.js"></script>
<script>
document.addEventListener("DOMContentLoaded", () => {
    const textarea = document.querySelector(".quill-editor");
    const editorDiv = document.getElementById("editor");

    textarea.style.display = "none";

    const quill = new Quill(editorDiv, {
        theme: "snow",
        modules: {
            toolbar: [
                [{ header: [1, 2, 3, 4, 5, false] }],
                ["bold", "italic", "underline", "strike"],
                [{ list: "ordered" }, { list: "bullet" }],
                [{ indent: "-1" }, { indent: "+1" }],
                [{ align: [] }],
                ["blockquote", "code-block"],
                ["link", "image", "video"],
                ["clean"]
            ]
        }
    });

    quill.root.innerHTML = textarea.value || '';

    quill.on("text-change", () => {
        textarea.value = quill.root.innerHTML;
    });
});
</script>
{% endblock scripts %}
