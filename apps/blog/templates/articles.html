{% extends 'base/base.html' %}

{% block title %}لیست مقالات{% endblock title %}

{% block meta %}
<meta name="description" content="لیست مقالات وبسایت">
{% endblock meta %}

{% block styles %}
<style>
  .article-card {
    border: 1px solid #dee2e6;
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 20px;
    display: flex;
    gap: 15px;
    align-items: flex-start;
    transition: 0.3s;
    cursor: pointer;
  }

  .article-card:hover {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    transform: translateY(-3px);
  }

  .pin {
    border: 2px solid #ffc107 !important;
    background: #fffbea !important;
  }

  .thumbnail {
    width: 130px;
    height: 90px;
    object-fit: cover;
    border-radius: 8px;
    flex-shrink: 0;
  }

  .thumbnail-placeholder {
    width: 130px;
    height: 90px;
    border-radius: 8px;
    flex-shrink: 0;
    background-color: #f0f0f0;
    display: flex;
    justify-content: center;
    align-items: center;
    color: #777;
    font-size: 0.8rem;
  }

  .article-title {
    font-size: 1.25rem;
    font-weight: bold;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .article-desc {
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-box-orient: vertical;
    margin-bottom: 8px;
  }

  .author-box {
    font-size: 0.9rem;
    color: #6c757d;
  }

  .sidebar-box {
    height: 400px;
    overflow-y: auto;
    border: 1px solid #ddd;
    padding: 10px;
    border-radius: 8px;
  }
</style>
{% endblock styles %}

{% block content %}
<div class="container mt-4">

  <div class="row">
    <div class="col-lg-9 col-md-8">

      <div class="d-flex justify-content-between align-items-center">
        <h1>مقالات
          {% if category %}
          <span class="badge bg-info text-dark">با برچسب {{ category.name }}</span>
          {% endif %}
        </h1>
        <a class="btn btn-primary" href="{% url 'blog:write-article' %}">نوشتن مقاله جدید</a>
      </div>

      {% if category %}
      <a href="{% url 'blog:articles' %}" class="btn btn-outline-secondary btn-sm mt-2">حذف فیلتر</a>
      {% endif %}

      <hr>

      {% for article in articles %}
      <div class="article-card {% if article.is_pin or article.most_visited %}pin{% endif %}"
        onclick="window.location='{{ article.get_absolute_url }}';">

        {% if article.thumbnail %}
        <img src="{{ article.thumbnail.url }}" class="thumbnail" alt="{{ article.title }}">
        {% else %}
        <div class="thumbnail-placeholder">بدون تصویر</div>
        {% endif %}

        <div>
          <h3 class="article-title">{{ article.title }}</h3>
          <p class="article-desc">{{ article.short_description }}</p>

          <p class="author-box">
            نویسنده: {{ article.author }}
            <span class="text-muted"> | {{ article.write_date|timesince }} قبل</span>
            <span class="text-muted"> | {{ article.views }} بازدید</span>
          </p>

          {% if article.is_pin %}
          <span class="badge bg-warning text-dark">ویژه</span>
          {% endif %}
          {% if article.most_visited %}
          <span class="badge bg-danger text-dark">پربازدید</span>
          {% endif %}
        </div>
      </div>
      {% empty %}
      <div class="alert alert-warning text-center">هیچ مقاله‌ای یافت نشد.</div>
      {% endfor %}

      {% include 'components/pagination.html' %}
    </div>

    <div class="col-lg-3 col-md-4">
      <div class="sidebar-box">
        <h5 class="mb-3">دسته‌بندی‌ها</h5>
        {% for category in categories %}
        <a href="{% url 'blog:article-list-category' category.slug %}" class="d-block mb-2 badge bg-light text-dark"
          style="font-size:0.9rem;border:1px solid #ccc;">
          {{ category.name }} ({{ category.article_count }})
        </a>
        {% endfor %}
      </div>
    </div>

  </div>
</div>
{% endblock content %}